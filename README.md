
پروژه مدیریت کارت

#### نیازمندی ها

جاوا 8

###### شرح پروژه

‫ پروژه با استفاده از spring boot وجاوا 8 نوشته شده است. دو میکروسرویس PaymentService و NotificationService نوشته شده است. برای manage کردن میکروسرویس های از EnableEurekaServer استفاده شده است.
 برای build کردن میکروسرویس ها کافی است دستور زیر را در مسیر روت هر پروژه اجرا کنید:

mvnw clean install

‫ و برای اجرای هر میکروسرویس دستور زیر را در مسیر root آن میکروسرویس اجرا کنید:

mvnw spring-boot:run

‫پس از اجرای پروژه میتوانید سرویس ها را با استفاده از کلاینت های Rest فراخوانی کنید.

‫برای تست پروژه از spring boot test و MockMvc استفاده شده است. جهت اجرای تست ها میتوانید دستور زیر را در مسیر root پروژه اجرا کنید:

mvnw clean test

پیاده سازی

هر پروژه شامل سه لایه است.

‫پایین ترین لایه، لایه دیتابیس است که در پکیج persistence قرار دارد. این لایه مسئول انجام کارهای دیتابیسی است و مدل ها یا entity های مختص به خود را دارد. برای مقداردهی اولیه دیتابیس هم فایل sql.data اضافه شده است. این فایل به صورت پیش فرض وقتی که دیتابیس in momory باشد، اجرا میشود تا داده تستی را فراهم کند. جهت راحتی در تست و اجرای برنامه از دیتابیس in memory h2 استفاده شده است. جهت کار با دیتابیس از spring-boot-starter-data-jpa استفاده شده است.

‫لایه بعدی لایه سرویس است که درواقع بیزینس برنامه در این لایه قرار میگیرد. این لایه نیز مدل های مخصوص به خود را دارد که در انتهای نام آنها dto نوشته شده است. مانند CardDto

‫بالاترین لایه، لایه وب که مسئول پردازش و ایجاد درخواست ها و پاسخ های http ( به عبارتی دیگر وب سرویس های rest) است. این لایه نیز مدل های مخصوص به خود را دارد که در انتهای آنها عبارت model نوشته شده است. مانند ContactModel. این لایه، لایه سرویس را فراخوانی میکند. برای exception Handling در این لایه، یک advice به نام RestErrorHandler نوشته شده است تا هر سرویس مجبور به هندل کردن جداگانه exception نشود.

‫از پلاگین Lombok نیز برای ایجاد getter و setter در مدل ها استفاده شده است.

برای ارتباط سرویس مدیریت کارت ها و سرویس Notification از بروکر Kafka استفاده شده است. به این صورت که بعد از انجام انتقال وجه، یک message در صف قرار میگیرد و سرویس notification آن پیغام را خوانده و ارسال میکند.
‫بهبودهای آتی: در حال حاضر طراحی به گونه ای است که اگر بروکر در دسترس نباشد، بخشی از نیازمندی پروژه، یعنی اطمینان از رسیدن پیام به provider برآورده نخواهد شد. میتوان برای رفع این مشکل، جدولی برای Notification های fail شده در نظر گرفت و در صورتی که بروکر در دسترس نبود، پیغام ها را در جدول ذخیره کرد و Job دیگری رکوردهای جدول را بخواند و هنگامی که بروکر در دسترس قرار گرفت در بروکر قرار دهد.


‫توجه: در مسیر پروژه فایلی به نام cardManagement.postman_collection.json قرار دارد که در صورتی که در postman آن را import کنید میتوانید نمونه درخواست های این سرویس ها را مشاهده و تست کنید. ****
‫توجه: برای تست سرویس ها بایستی در سیستم لاگین باشید. کاربر e.ghafarzadeh با پسورد password در data.sql ذخیره شده است. بنابراین میتوانید در درخواست های خود، هدر Authorization را با مقدار Basic ZS5naGFmYXJ6YWRlaDpwYXNzd29yZA== ارسال نمایید. ****

